'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),require('eventsource-polyfill');var formatters={plain:function plain(a){return a.data},json:function json(a){return JSON.parse(a.data)}};exports.default={install:function install(a){a.SSE=a.prototype.$sse=function(a,b){var c=Object.assign({},{withCredentials:!1,format:'plain'},b),d=new EventSource(a,{withCredentials:c.withCredentials});return new Promise(function(a,b){d.onerror=b,d.onopen=function(){d.onerror=null;var b={};a({getSource:function getSource(){return d},onError:function onError(a){return d.onerror=a,this},subscribe:function subscribe(a,f){var e=function(a){var b;try{b=formatters[c.format](a)}catch(a){d.onerror(a)}f(b)};return b[a]||(b[a]=[]),b[a].push(e),''===a?d.onmessage=e:d.addEventListener(a,e),this},unsubscribe:function unsubscribe(a){return''===a?(d.onmessage=null,this):b[a]?(b[a].forEach(function(b){d.removeEventListener(a,b)}),b[a]=[],this):this},close:function close(){d.close(),Object.keys(b).forEach(function(a){b[a]=[]})}})}})}}};
