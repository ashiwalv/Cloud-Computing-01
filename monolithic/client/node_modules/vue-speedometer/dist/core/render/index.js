"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=exports.update=void 0;var _d=require("d3"),_util=require("../util"),_getNeedleTransition=require("../util/get-needle-transition"),_configure=require("../config/configure"),update=function(a){var b=a.d3_refs,c=a.newValue,d=a.config,e=(0,_configure.configureScale)(d),f=e(c),g=d.maxAngle-d.minAngle,h=d.minAngle+f*g;b.pointer.transition().duration(d.needleTransitionDuration).ease((0,_getNeedleTransition.getNeedleTransition)(d.needleTransition)).attr("transform","rotate(".concat(h,")")),b.current_value_text.text((0,_util.formatCurrentValueText)(c,d))};exports.update=update;var render=function(a){var b=a.container,c=a.config,d=(0,_util.getRadius)(c),e=(0,_util.centerTranslation)(d),f=_renderSVG({container:b,config:c});return _renderArcs({config:c,svg:f,centerTx:e}),_renderLabels({config:c,svg:f,centerTx:e,r:d}),{current_value_text:_renderCurrentValueText({config:c,svg:f}),pointer:_renderNeedle({config:c,svg:f,r:d,centerTx:e})}};exports.render=render;function _renderSVG(a){var b=a.container,c=a.config;return(0,_d.select)(b).append("svg:svg").attr("class","speedometer").attr("width",c.width).attr("height",c.height)}function _renderArcs(a){var b=a.config,c=a.svg,d=a.centerTx,e=(0,_configure.configureTickData)(b),f=(0,_configure.configureArc)(b),g=c.append("g").attr("class","arc").attr("transform",d);g.selectAll("path").data(e).enter().append("path").attr("class","speedo-segment").attr("fill",function(a,c){return 0===b.customSegmentStops.length?b.arcColorFn(a*c):b.segmentColors&&b.segmentColors[c]?b.segmentColors[c]:b.arcColorFn(a*c)}).attr("d",f)}function _renderLabels(a){var b=a.config,c=a.svg,d=a.centerTx,e=a.r,f=(0,_configure.configureTicks)(b),g=(0,_configure.configureTickData)(b),h=(0,_configure.configureScale)(b),j=b.maxAngle-b.minAngle,k=c.append("g").attr("class","label").attr("transform",d);k.selectAll("text").data(f).enter().append("text").attr("transform",function(a,c){var d=0===b.customSegmentStops.length?h(a):(0,_util.sumArrayTill)(g,c),f=b.minAngle+d*j;return"rotate(".concat(f,") translate(0, ").concat(b.labelInset-e,")")}).text(b.labelFormat).attr("class","segment-value").style("text-anchor","middle").style("font-size","14px").style("font-weight","bold").style("fill",b.textColor)}function _renderCurrentValueText(a){var b=a.config,c=a.svg;return c.append("g").attr("transform","translate(".concat(b.width/2,", ").concat(b.width/2,")")).append("text").attr("class","current-value").attr("text-anchor","middle").attr("y",23).text(b.currentValue||"amaidhi").style("font-size","16px").style("font-weight","bold").style("fill",b.textColor)}function _renderNeedle(a){var b=a.config,c=a.svg,d=a.r,e=a.centerTx,f=(0,_util.calculateNeedleHeight)({heightRatio:b.needleHeightRatio,radius:d}),g=[[b.pointerWidth/2,0],[0,-f],[-(b.pointerWidth/2),0],[0,b.pointerTailLength],[b.pointerWidth/2,0]],h=(0,_d.line)().curve(_d.curveMonotoneX),i=c.append("g").data([g]).attr("class","pointer").attr("transform",e).style("fill",b.needleColor);return i.append("path").attr("d",h).attr("transform","rotate(".concat(b.minAngle,")"))}